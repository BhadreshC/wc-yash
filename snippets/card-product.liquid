{% comment %}
  Renders a product card

  Accepts:
  - card_product: {Object} Product Liquid object (optional)
  - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
  - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
  - show_vendor: {Boolean} Show the product vendor. Default: false
  - show_rating: {Boolean} Show the product rating. Default: false
  - extend_height: {Boolean} Card height extends to available container space. Default: true (optional)
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)
  - show_quick_add: {Boolean} Show the quick add button.
  - section_id: {String} The ID of the section that contains this card.
  - horizontal_class: {Boolean} Add a card--horizontal class if set to true. Default: false

  Usage:
  {% render 'card-product', show_vendor: section.settings.show_vendor %}
{% endcomment %}

{{ 'component-rating.css' | asset_url | stylesheet_tag }}
{{ 'section-main-product.css' | asset_url | stylesheet_tag }}

{%- if card_product and card_product != empty -%}
  {%- liquid
    assign ratio = 1
    if card_product.featured_media and media_aspect_ratio == 'portrait'
      assign ratio = 0.8
    elsif card_product.featured_media and media_aspect_ratio == 'adapt'
      assign ratio = card_product.featured_media.aspect_ratio
    endif
    if ratio == 0 or ratio == null
      assign ratio = 1
    endif
  -%}
  <div class="card-wrapper product-card-wrapper underline-links-hover">
    <div
      class="
        card
        card--{{ settings.card_style }}
        {% if card_product.featured_media %} card--media{% else %} card--text{% endif %}
        {% if settings.card_style == 'card' %} color-{{ settings.card_color_scheme }} gradient{% endif %}
        {% if extend_height %} card--extend-height{% endif %}
        {% if card_product.featured_media == nil and settings.card_style == 'card' %} ratio{% endif %}
        {% if horizontal_class %} card--horizontal{% endif %}
      "
      style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;"
    >
      <div
        class="card__inner {% if settings.card_style == 'standard' %}color-{{ settings.card_color_scheme }} gradient{% endif %}{% if card_product.featured_media or settings.card_style == 'standard' %} ratio{% endif %}"
        style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;"
      >
        {%- if card_product.featured_media -%}
          <div class="card__media">
            <div class="media media--transparent media--hover-effect">
              {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
              <img
                srcset="
                  {%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                  {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w
                "
                src="{{ card_product.featured_media | image_url: width: 533 }}"
                sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                alt="{{ card_product.featured_media.alt | escape }}"
                class="motion-reduce"
                {% unless lazy_load == false %}
                  loading="lazy"
                {% endunless %}
                width="{{ card_product.featured_media.width }}"
                height="{{ card_product.featured_media.height }}"
              >
              {% comment %}theme-check-enable ImgLazyLoading{% endcomment %}

              {%- if card_product.media[1] != null and show_secondary_image -%}
                <img
                  srcset="
                    {%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | image_url: width: 165 }} 165w,{%- endif -%}
                    {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | image_url: width: 360 }} 360w,{%- endif -%}
                    {%- if card_product.media[1].width >= 533 -%}{{ card_product.media[1] | image_url: width: 533 }} 533w,{%- endif -%}
                    {%- if card_product.media[1].width >= 720 -%}{{ card_product.media[1] | image_url: width: 720 }} 720w,{%- endif -%}
                    {%- if card_product.media[1].width >= 940 -%}{{ card_product.media[1] | image_url: width: 940 }} 940w,{%- endif -%}
                    {%- if card_product.media[1].width >= 1066 -%}{{ card_product.media[1] | image_url: width: 1066 }} 1066w,{%- endif -%}
                    {{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w
                  "
                  src="{{ card_product.media[1] | image_url: width: 533 }}"
                  sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                  alt=""
                  class="motion-reduce"
                  loading="lazy"
                  width="{{ card_product.media[1].width }}"
                  height="{{ card_product.media[1].height }}"
                >
              {%- endif -%}
            </div>
          </div>
        {%- endif -%}
        <div class="card__content">
          <div class="card__information">
            <h3
              class="card__heading"
              {% if card_product.featured_media == null and settings.card_style == 'standard' %}
                id="title-{{ section_id }}-{{ card_product.id }}"
              {% endif %}
            >
              <a
                href="{{ card_product.url }}"
                id="StandardCardNoMediaLink-{{ section_id }}-{{ card_product.id }}"
                class="full-unstyled-link"
                aria-labelledby="StandardCardNoMediaLink-{{ section_id }}-{{ card_product.id }} NoMediaStandardBadge-{{ section_id }}-{{ card_product.id }}"
              >
                {{ card_product.title | escape }}
              </a>
            </h3>
          </div>

          <div class="card__badge {{ settings.badge_position }}">
            {%- if card_product.available == false -%}
              <span
                id="NoMediaStandardBadge-{{ section_id }}-{{ card_product.id }}"
                class="badge badge--bottom-left color-{{ settings.sold_out_badge_color_scheme }}"
              >
                {{- 'products.product.sold_out' | t -}}
              </span>
            {%- elsif card_product.compare_at_price > card_product.price and card_product.available -%}
              <span
                id="NoMediaStandardBadge-{{ section_id }}-{{ card_product.id }}"
                class="badge badge--bottom-left color-{{ settings.sale_badge_color_scheme }}"
              >
                {{- 'products.product.on_sale' | t -}}
              </span>
            {%- endif -%}
          </div>
        </div>
      </div>
      <div class="card__content">
        <div class="card__information">
          <h3
            class="card__heading{% if card_product.featured_media or settings.card_style == 'standard' %} h5{% endif %}"
          >
            <a
              href="{{ card_product.url }}"
              id="CardLink-{{ section_id }}-{{ card_product.id }}"
              class="full-unstyled-link"
              aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }} Badge-{{ section_id }}-{{ card_product.id }}"
            >
              {{ card_product.title | escape }}
            </a>
            <div class="add-wishlist-btn">
              <a href="#" class="wishlist-btn">
                <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12.5 23.4863C12.3279 23.4863 12.1558 23.4259 12.0177 23.3051C10.9193 22.344 9.88784 21.4669 8.89033 20.6187C3.53677 16.0661 0 13.0585 0 8.66772C0 4.73643 2.80283 1.51367 6.64062 1.51367C8.70913 1.51367 10.5063 2.50693 11.8378 4.38613C12.1001 4.75625 12.3193 5.12593 12.5 5.46953C12.6806 5.12598 12.8999 4.75625 13.1622 4.38613C14.4937 2.50693 16.2909 1.51367 18.3594 1.51367C22.1977 1.51367 25 4.73706 25 8.66772C25 13.0584 21.4632 16.066 16.1098 20.6186C15.1122 21.4668 14.0807 22.344 12.9823 23.3051C12.8442 23.4259 12.6721 23.4863 12.5 23.4863ZM6.64062 2.97852C3.68994 2.97852 1.46484 5.42437 1.46484 8.66772C1.46484 12.3813 4.79639 15.2143 9.83926 19.5027C10.6937 20.2293 11.5731 20.9771 12.5 21.7822C13.4269 20.9771 14.3063 20.2293 15.1608 19.5026C20.2037 15.2143 23.5352 12.3813 23.5352 8.66772C23.5352 5.42437 21.3101 2.97852 18.3594 2.97852C16.7762 2.97852 15.4377 3.72583 14.3811 5.19976C13.5476 6.36235 13.2092 7.5562 13.206 7.56816C13.1177 7.88496 12.829 8.10478 12.5002 8.10478C12.4997 8.10478 12.4992 8.10478 12.4988 8.10478C12.1699 8.10415 11.8816 7.88506 11.794 7.56816C11.7907 7.55625 11.4523 6.36235 10.6189 5.19976C9.56226 3.72583 8.22373 2.97852 6.64062 2.97852Z" fill="black"/>
                </svg>
              </a>
            </div>
          </h3>

          <div
            class="wc_product_review_badge"
            data-handle="{{ card_product.handle }}"
            data-product_id="{{ card_product.id }}"
          ></div>
          <div class="card-information">
            {%- if show_vendor -%}
              <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
              <div class="caption-with-letter-spacing light">{{ card_product.vendor }}</div>
            {%- endif -%}

            <span class="caption-large light">{{ block.settings.description | escape }}</span>

            {%- if show_rating and card_product.metafields.reviews.rating.value != blank -%}
              {% liquid
                assign rating_decimal = 0
                assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1
                if decimal >= 0.3 and decimal <= 0.7
                  assign rating_decimal = 0.5
                elsif decimal > 0.7
                  assign rating_decimal = 1
                endif
              %}
              <div
                class="rating"
                role="img"
                aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: card_product.metafields.reviews.rating.value, rating_max: card_product.metafields.reviews.rating.value.scale_max }}"
              >
                <span
                  aria-hidden="true"
                  class="rating-star color-icon-{{ settings.accent_icons }}"
                  style="--rating: {{ card_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ card_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                ></span>
              </div>
              <p class="rating-text caption">
                <span aria-hidden="true">
                  {{- card_product.metafields.reviews.rating.value }} /
                  {{ card_product.metafields.reviews.rating.value.scale_max -}}
                </span>
              </p>
              <p class="rating-count caption">
                <span aria-hidden="true">({{ card_product.metafields.reviews.rating_count }})</span>
                <span class="visually-hidden">
                  {{- card_product.metafields.reviews.rating_count }}
                  {{ 'accessibility.total_reviews' | t -}}
                </span>
              </p>
            {%- endif -%}

            {% render 'price', product: card_product, price_class: '' %}
          </div>
        </div>

           <div class="variant_selector">
                {% for option in card_product.options_with_values %}
                   <fieldset class="product_form_input"  >
                  {% assign option_index = forloop.index %}
                  <div class="form_label" for="option-{{ card_product.id }}">{{ option.name }}</div>
                    <div class="product_var">
                      {% for value in option.values %}
                      <input type="radio" name="{{ card_product.id }}-{{ option.name }}" data-qty="1" data-id="{{ variant.id }}" id="{{ card_product.id }}-{{ option_index }}-{{ forloop.index }}" data-title="{{ value }}"  class="variant_button" value="{{ value }}">
                      <label class="variant_button-label" for="{{ card_product.id }}-{{ option_index }}-{{ forloop.index }}" >{{ value }}</label>
                     {% endfor %} 
                    </div>
                   </fieldset>
                {% endfor %}  
                <select id="option-{{ card_product.id }}" class="product-form__variants hidden">
                  {% for variant in card_product.variants %}
                    {% if variant.available %}
                      <option
                        {% if variant == card_product.selected_or_first_available_variant %}
                          selected="selected"
                        {% endif %}
                        data-id="{{ variant.id }}"
                        data-qty="1"
                        data-title="{{ variant.title }}"
                        data-price="{{ variant.price }}"
                        value="{{ variant.id }}"
                      >
                        {{ variant.title }}
                      </option>
                    {% else %}
                      <option disabled="disabled">{{ variant.title }} - {{ 'products.product.sold_out' | t }}</option>
                    {% endif %}
                  {% endfor %}
                </select>
           </div>

        {%- if show_quick_add -%}
          {%- assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id -%}
          {% assign variant = card_product.selected_or_first_available_variant %}
          {%- form 'product',
            card_product,
            id: product_form_id,
            class: 'form',
            novalidate: 'novalidate',
            data-type: 'add-to-cart-form'
          -%}
            <input type="hidden" name="id" value="{{ variant.id }}">
            <input type="hidden" name="quantity" value="1">
          {%- endform -%}
          {% assign variant = card_product.selected_or_first_available_variant %}
          <button
            data-id="{{ variant.id }}"
            data-qty="1"
            type="submit"
            name="add"
            class="quick-add__submit add_to_cart button  button--secondary cart-add-btn"
            {% if card_product.selected_or_first_available_variant.available == false %}
              disabled
            {% endif %}
          >
            <span>
              {%- if card_product.selected_or_first_available_variant.available -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- else -%}
                {{ 'products.product.sold_out' | t }}
              {%- endif -%}
            </span>
            <span class="sold-out-message hidden">
              {{ 'products.product.sold_out' | t }}
            </span>
            <div class="loading-overlay__spinner hidden">
              <svg
                aria-hidden="true"
                focusable="false"
                role="presentation"
                class="spinner"
                viewBox="0 0 66 66"
                xmlns="http://www.w3.org/2000/svg"
              >
                <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
              </svg>
            </div>
          </button>
        {%- endif -%}
        <div class="card__badge {{ settings.badge_position }}">
          {%- if card_product.available == false -%}
            <span
              id="Badge-{{ section_id }}-{{ card_product.id }}"
              class="badge badge--bottom-left color-{{ settings.sold_out_badge_color_scheme }}"
            >
              {{- 'products.product.sold_out' | t -}}
            </span>
          {%- elsif card_product.compare_at_price > card_product.price and card_product.available -%}
            <span
              id="Badge-{{ section_id }}-{{ card_product.id }}"
              class="badge badge--bottom-left color-{{ settings.sale_badge_color_scheme }}"
            >
              {{- 'products.product.on_sale' | t -}}
            </span>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
{%- else -%}
  <div class="product-card-wrapper card-wrapper underline-links-hover">
    <div
      class="
        card
        card--{{ settings.card_style }}
        card--text
        {% if extend_height %} card--extend-height{% endif %}
        {% if settings.card_style == 'card' %} color-{{ settings.card_color_scheme }} gradient{% endif %}
        {% if card_product.featured_media == nil and settings.card_style == 'card' %} ratio{% endif %}
        {{ horizontal_class }}
      "
      style="--ratio-percent: 100%;"
    >
      <div
        class="card__inner {% if settings.card_style == 'standard' %}color-{{ settings.card_color_scheme }} gradient{% endif %}{% if settings.card_style == 'standard' %} ratio{% endif %}"
        style="--ratio-percent: 100%;"
      >
        <div class="card__content">
          <div class="card__information">
            <h3 class="card__heading">
              <a role="link" aria-disabled="true" class="full-unstyled-link">
                {{ 'onboarding.product_title' | t }}
              </a>
            </h3>
          </div>
        </div>
      </div>
      <div class="card__content">
        <div class="card__information">
          <h3 class="card__heading{% if settings.card_style == 'standard' %} h5{% endif %}">
            <a role="link" aria-disabled="true" class="full-unstyled-link">
              {{ 'onboarding.product_title' | t }}
            </a>
          </h3>
          <div class="card-information">
            {%- if show_vendor -%}
              <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
              <div class="caption-with-letter-spacing light">{{ 'products.product.vendor' | t }}</div>
            {%- endif -%}
            {% render 'price' %}
          </div>
        </div>
      </div>
    </div>
  </div>
{%- endif -%}

<script>
    $(function() {
      $(' .card__heading a').matchHeight({ byRow: 0 });
  });






    //  var productQTY = Number($(this).attr('data-qty'));
    // var productvalue = Number($(this).attr('data-id'));
    // var formId = $(this).parent('form').attr('id');
    // var form = document.getElementById(formId);
    // var formData = new FormData(form);
    // if(document.querySelector('cart-drawer')) {
    //   formData.append('sections', document.querySelector('cart-drawer').getSectionsToRender().map((section) => section.id));
    // } else if (document.querySelector('cart-notification')) {
    //   formData.append('sections', document.querySelector('cart-notification').getSectionsToRender().map((section) => section.id));
    // }
    // console.log(formData)

    // $.ajax({
    //    type: 'POST',
    //    url: '/cart/add.js',
    //    dataType: "json",
    //    data: {
    //       productQTY,
    //       productvalue,
    //        formData
    //    },
    //    success: function (response) {
    //       setTimeout(function () {
    //         $(".add_to_cart").addClass("loading");
    //         $(".add_to_cart .loading-overlayspinner").removeClass("hidden");
    //         setTimeout(function () {
    //           $(".add_to_cart").removeClass("loading").html($('.add_to_cart').html().replace("Add To Cart", "Added"));
    //           $(".add_to_cart .loading-overlayspinner").addClass("hidden");
    //           if (document.querySelector('cart-drawer')) {
    //             $(".drawer").addClass("animate active").removeClass('is-empty');
    //             $("body").addClass("overflow-hidden");
    //             document.querySelector('cart-drawer').renderContents(response);
    //           } else if (document.querySelector('cart-notification')){
    //             document.querySelector('cart-notification').renderContents(response);
    //           }
    //         }, 1000);
    //       }, 0)
    //     }
    // })
       // console.log(document.querySelector('cart-drawer'))
      // setTimeout(() => { document.getElementsByTagName('cart-drawer')[0].renderContents(response)});

    // $(".drawer").addClass("animate active");


 
</script>
